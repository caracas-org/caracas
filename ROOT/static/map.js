// Generated by CoffeeScript 1.4.0
(function() {
  var addMarker, markers, setAllMarker;

  markers = {};

  addMarker = function(achievement) {
    var idx, lat, latLng, lon;
    lat = achievement.achievement_lat;
    lon = achievement.achievement_lon;
    latLng = [lat, lon];
    idx = "i" + lat + "|" + lon;
    if (markers.hasOwnProperty(idx)) {
      return;
    }
    markers[idx] = true;
    return L.marker(latLng).addTo(map);
  };

  setAllMarker = function() {
    var bounds, delta, lad, lat, lod, lon, nela, nelo, swla, swlo, url;
    bounds = map.getBounds();
    swla = bounds._southWest.lat;
    swlo = bounds._southWest.lng;
    nela = bounds._northEast.lat;
    nelo = bounds._northEast.lng;
    lad = nela - swla;
    lod = nelo - swlo;
    lat = (swla + nela) / 2;
    lon = (swlo + nelo) / 2;
    delta = Math.max(lad, lod);
    delta *= 1.5;
    url = "/a/api/get/?format=json&lat=" + lat + "&lon=" + lon + "&box_radius=" + delta;
    console.log('moveend', map.getBounds());
    console.log(url);
    $.getJSON(url, function(data) {
      var achievement, _i, _len, _ref, _results;
      _ref = data.achievements;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        achievement = _ref[_i];
        _results.push(addMarker(achievement));
      }
      return _results;
    });
  };

  map.on('moveend', setAllMarker);

  setAllMarker();

}).call(this);
